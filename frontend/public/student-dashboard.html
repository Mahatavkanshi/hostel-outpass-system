<!DOCTYPE html>
<html lang="en" class="transition duration-300">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Student Dashboard</title>

  <!-- ‚úÖ Persist Dark Mode Early -->
  <script>
    if (localStorage.getItem("theme") === "dark") {
      document.documentElement.classList.add("dark");
    }
  </script>


  <!-- ‚úÖ Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
    };
  </script> 

  <!-- face-api.js (CDN) -->
<script defer src="https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/dist/face-api.min.js"></script>

</head>

<body class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100 min-h-screen font-sans">

  <!-- ‚úÖ Load Navbar -->
  <div id="navbar"></div>
  <script>
    fetch("navbar-student.html")
      .then(res => res.text())
      .then(data => {
        document.getElementById("navbar").innerHTML = data;

        const toggle = document.getElementById("darkToggle");
        const root = document.documentElement;

        if (localStorage.getItem("theme") === "dark") {
          root.classList.add("dark");
          toggle && (toggle.checked = true);
        }

        toggle?.addEventListener("change", () => {
          if (toggle.checked) {
            root.classList.add("dark");
            localStorage.setItem("theme", "dark");
          } else {
            root.classList.remove("dark");
            localStorage.setItem("theme", "light");
          }
        });

        window.logout = function () {
          localStorage.removeItem("token");
          localStorage.removeItem("user");
          window.location.href = "index.html";
        };
      });
  </script>

  <!-- ‚úÖ Profile Alert -->
  <div id="profileAlert" class="hidden max-w-4xl mx-auto mt-6 p-4 bg-yellow-100 border-l-4 border-yellow-500 text-yellow-800 dark:bg-yellow-200 dark:text-yellow-900 rounded shadow">
    <p class="font-semibold">
      ‚ö†Ô∏è Incomplete Profile! <a href="profile.html" class="underline text-blue-700 hover:text-blue-900">Click here to complete it</a> to access all features.
    </p>
  </div>

  <!-- ‚úÖ Dashboard Content -->
  <div class="max-w-5xl mx-auto mt-8 p-6 bg-white dark:bg-gray-800 shadow-lg rounded-lg">
    <h2 class="text-2xl font-bold mb-4">
      Welcome, <span id="studentName" class="text-blue-600 dark:text-blue-400">Student</span>
    </h2>
<button id="chatWithWardenBtn" 
  class="bg-blue-600 text-white px-4 py-2 rounded shadow hover:bg-blue-700 mb-4">
  üí¨ Chat with Warden
</button>



    <h3 class="text-xl font-semibold mt-6 mb-4">Your Outpass Requests</h3>

    <div class="overflow-x-auto">
      <table class="min-w-full bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded">
        <thead>
          <tr class="bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-white">
            <th class="py-2 px-4 border-b">Date</th>
            <th class="py-2 px-4 border-b">Time Out</th>
            <th class="py-2 px-4 border-b">Time In</th>
            <th class="py-2 px-4 border-b">Place</th>
            <th class="py-2 px-4 border-b">Reason</th>
            <th class="py-2 px-4 border-b">Status</th>
          </tr>
        </thead>
        <tbody id="outpassTableBody" class="text-gray-800 dark:text-gray-100"></tbody>
      </table>
    </div>

    <p id="msg" class="text-center text-red-600 mt-4 dark:text-red-400"></p>

    <!-- ‚úÖ Location Sharing Alert (Only if Late) -->
    <div id="lateNotice" class="hidden mt-6 p-4 bg-red-100 border border-red-400 text-red-700 rounded">
      <p class="font-semibold mb-2">‚ö†Ô∏è You are late to return!</p>
      <button onclick="sendLocationFromLateNotice()" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">
        Send My Location to Warden
      </button>
    </div>
  </div>

<!-- ‚úÖ Face Capture Section -->
<div id="faceCaptureContainer" class="mt-4 hidden">
  <button id="openCameraBtn" class="bg-green-600 text-white px-4 py-2 rounded shadow hover:bg-green-700">
    üé• Open Camera & Capture Face
  </button>

  <!-- Camera Preview -->
  <div id="cameraBox" class="mt-3 hidden">
    <video id="video" autoplay playsinline class="w-64 h-48 border rounded"></video>
    <br>
    <button id="captureBtn" class="mt-2 bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700">
      üì∏ Capture
    </button>
    <canvas id="canvas" class="hidden"></canvas>
  </div>

  <!-- Status -->
  <p id="faceStatus" class="text-sm mt-2 text-gray-600"></p>
</div>


 
  <div id="locationContainer" class="mt-4 hidden">
  <button id="sendLocationBtn" class="bg-blue-600 text-white px-4 py-2 rounded shadow hover:bg-blue-700">
    üìç Share Location with Warden
  </button>
  <p id="locationStatus" class="text-sm mt-2 text-gray-600"></p>
</div>

<!-- MARK RETURN BUTTON -->
<div class="max-w-5xl mx-auto mt-6 text-center">
  <button id="markReturnBtn" class="bg-green-600 text-white px-4 py-2 rounded shadow hover:bg-green-700">
    üì∑ Mark Me Returned
  </button>
  <p id="returnMsg" class="mt-2 text-sm text-gray-600"></p>
</div>

<!-- RETURN MODAL (hidden, shown by JS) -->
<div id="returnModal" class="hidden fixed inset-0 z-50 bg-black bg-opacity-50 items-center justify-center">
  <div class="bg-white dark:bg-gray-800 p-4 rounded shadow w-[360px] mx-4">
    <h3 class="text-lg font-semibold mb-2">Verify Face & Location</h3>
    <video id="returnVideo" autoplay muted playsinline class="w-full rounded bg-black"></video>
    <div class="flex gap-2 mt-3">
      <button id="returnCaptureBtn" class="flex-1 bg-yellow-500 text-black py-2 rounded">Capture</button>
      <button id="returnSubmitBtn" class="flex-1 bg-blue-600 text-white py-2 rounded">Submit</button>
      <button id="returnCancelBtn" class="flex-1 bg-gray-300 text-black py-2 rounded">Cancel</button>
    </div>
    <p id="returnStatus" class="mt-2 text-sm text-gray-700"></p>
    <p class="mt-2 text-xs text-gray-500">Capture 1‚Äì3 samples for better accuracy. Allow camera & location when prompted.</p>
  </div>
</div>

<!-- Chat Sidebar -->
<div id="chatSidebar" 
     class="hidden fixed bottom-0 right-4 w-80 h-96 bg-white dark:bg-gray-800 shadow-lg rounded-t-lg flex flex-col">

  <!-- Header -->
  <div class="flex justify-between items-center bg-blue-600 text-white px-4 py-2 rounded-t-lg">
    <span class="font-semibold">Chat with Warden</span>
      <div class="flex gap-2">
    <!-- üîπ video call button -->
    <button id="startVideoCallBtn" title="Start Video Call" class="hover:text-gray-200">üìπ</button>
    <button id="closeChatBtn" class="text-white hover:text-gray-200">‚úñ</button>
  </div>
</div>

  <!-- Messages -->
  <div id="chatMessages" class="flex-1 p-3 overflow-y-auto text-sm space-y-2">
    <!-- Messages will appear here -->
  </div>

  <!-- Input -->
  <div class="p-2 border-t dark:border-gray-700 flex">
    <input id="chatInput" 
           type="text" 
           placeholder="Type a message..." 
           class="flex-1 border rounded-l px-2 py-1 text-sm dark:bg-gray-700 dark:text-white"/>
    <button id="sendChatBtn" 
            class="bg-blue-600 text-white px-3 rounded-r hover:bg-blue-700">Send</button>
  </div>
</div>
<!-- üîπ Video Call Modal -->
<div id="videoCallModal" class="hidden fixed inset-0 z-50 bg-black bg-opacity-70 flex items-center justify-center">
  <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-lg w-[600px] flex flex-col gap-2">
    <h3 class="text-lg font-semibold mb-2 text-center">üìπ Video Call with Warden</h3>

    <div class="flex gap-2">
      <!-- local video -->
      <video id="localVideo" autoplay muted playsinline class="w-1/2 bg-black rounded"></video>
      <!-- remote video -->
      <video id="remoteVideo" autoplay playsinline class="w-1/2 bg-black rounded"></video>
    </div>

    <div class="flex justify-center mt-3 gap-4">
      <button id="endCallBtn" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">
        End Call
      </button>
    </div>
  </div>
</div>


  <!-- ‚úÖ Load Other Scripts -->
  <script src="js/api.js"></script>
  <script src="js/studentDashboard.js"></script>
</body>
</html>










